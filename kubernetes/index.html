



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="http://torre.me.uk/docs/kubernetes/">
      
      
        <meta name="author" content="sentenza">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.6">
    
    
      
        <title>Kubernetes - Sentenza's notes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#757575">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700|Fira+Mono">
        <style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="grey" data-md-color-accent="deep-purple">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#terminology" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
    <nav class="md-header-nav md-grid">
        <div class="md-flex">

            <div class="md-flex__cell md-flex__cell--shrink">
                <a href="https://torre.me.uk" title="Go back to the homepage" class="md-header-nav__button md-logo">
                    <i class="md-icon">home</i>
                </a>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
                <a href="http://torre.me.uk/docs" title="Sentenza's notes"
                    class="md-header-nav__button md-logo"><i
                        class="md-icon">library_books</i></a>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button"
                    for="__drawer"></label></div>
            <div class="md-flex__cell md-flex__cell--stretch">
                <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span
                        class="md-header-nav__topic">Sentenza's notes</span><span
                        class="md-header-nav__topic">Kubernetes</span></div>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><label
                    class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div></div><div
                class="md-flex__cell md-flex__cell--shrink">
                <div class="md-header-nav__source">


  


  <a href="https://github.com/sentenza/docs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      sentenza/docs
    </div>
  </a>
</div>
            </div></div>
    </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="http://torre.me.uk/docs" title="Sentenza's notes" class="md-nav__button md-logo">
      
        <i class="md-icon">library_books</i>
      
    </a>
    Sentenza's notes
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/sentenza/docs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      sentenza/docs
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../category_theory/" title="Category Theory" class="md-nav__link">
      Category Theory
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../scala/" title="Scala" class="md-nav__link">
      Scala
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Kubernetes
      </label>
    
    <a href="./" title="Kubernetes" class="md-nav__link md-nav__link--active">
      Kubernetes
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#terminology" title="Terminology" class="md-nav__link">
    Terminology
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-a-pod" title="What is a pod??" class="md-nav__link">
    What is a pod??
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-plugins" title="Kubernetes "plugins"" class="md-nav__link">
    Kubernetes "plugins"
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-manage-the-google-kubernetes-engine" title="How to manage the Google Kubernetes Engine" class="md-nav__link">
    How to manage the Google Kubernetes Engine
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-a-static-ip-and-a-custom-domain-for-the-application" title="Setting a static IP and a custom domain for the application" class="md-nav__link">
    Setting a static IP and a custom domain for the application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-image-used-for-the-current-kubernetes-pod" title="Update the image used for the current Kubernetes POD" class="md-nav__link">
    Update the image used for the current Kubernetes POD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-a-kubernetes-service" title="Delete a Kubernetes service" class="md-nav__link">
    Delete a Kubernetes service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-and-dbs-on-gke" title="Storage and DBs on GKE" class="md-nav__link">
    Storage and DBs on GKE
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../links/" title="Links" class="md-nav__link">
      Links
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#terminology" title="Terminology" class="md-nav__link">
    Terminology
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-a-pod" title="What is a pod??" class="md-nav__link">
    What is a pod??
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-plugins" title="Kubernetes "plugins"" class="md-nav__link">
    Kubernetes "plugins"
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-manage-the-google-kubernetes-engine" title="How to manage the Google Kubernetes Engine" class="md-nav__link">
    How to manage the Google Kubernetes Engine
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-a-static-ip-and-a-custom-domain-for-the-application" title="Setting a static IP and a custom domain for the application" class="md-nav__link">
    Setting a static IP and a custom domain for the application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-image-used-for-the-current-kubernetes-pod" title="Update the image used for the current Kubernetes POD" class="md-nav__link">
    Update the image used for the current Kubernetes POD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-a-kubernetes-service" title="Delete a Kubernetes service" class="md-nav__link">
    Delete a Kubernetes service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-and-dbs-on-gke" title="Storage and DBs on GKE" class="md-nav__link">
    Storage and DBs on GKE
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/sentenza/docs/edit/master/docs/kubernetes.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Kubernetes</h1>
                
                <blockquote>
<p>So Kubernetes is pronounced /koo-ber-nay'-tace/ and <a href="https://www.biblestudytools.com/lexicons/greek/nas/kubernetes.html">means "sailing master"</a></p>
</blockquote>
<p>Via <a href="https://twitter.com/francesc/status/487412202932936704">@francesc</a></p>
<h2 id="terminology">Terminology</h2>
<ul>
<li><strong>Node</strong>: A single virtual or physical machine in a Kubernetes cluster.</li>
<li><strong>Cluster:</strong> A group of nodes firewalled from the internet, that are the primary compute resources managed by Kubernetes.</li>
<li><strong>Edge router:</strong> A router that enforces the firewall policy for your cluster. This could be a gateway managed by a cloud provider or a physical piece of hardware.</li>
<li><strong>Cluster network:</strong> A set of links, logical or physical, that facilitate communication within a cluster according to the <a href="https://kubernetes.io/docs/concepts/cluster-administration/networking/">Kubernetes networking model</a>. Examples of a Cluster network include Overlays such as flannel or SDNs such as OVS.</li>
<li><strong>Service:</strong> A Kubernetes Service that identifies a set of pods using label selectors. Unless mentioned otherwise, Services are assumed to have virtual IPs only routable within the cluster network.</li>
</ul>
<h3 id="what-is-a-pod">What is a pod??</h3>
<p>A <strong>pod is a group of one or more containers</strong> (such as Docker containers), with shared storage/network, and a specification for how to run the containers. A pod’s contents are always co-located and co-scheduled, and run in a shared context.</p>
<p>Containers within a pod share an IP address and port space, and can find each other via localhost. They can also communicate with each other using standard inter-process communications like SystemV semaphores or POSIX shared memory. Containers in different pods have distinct IP addresses and can not communicate by IPC without special configuration. These containers usually communicate with each other via Pod IP addresses.</p>
<p>In terms of Docker constructs, <strong>a pod is modelled as a group of Docker containers with shared namespaces and shared volumes</strong>.</p>
<h3 id="kubernetes-plugins">Kubernetes "plugins"</h3>
<ul>
<li><a href="https://docs.helm.sh/">Helm Tiller</a>: Helm is a package manager for Kubernetes and is required to install all the other applications. It is installed in its own pod inside the cluster which can run the <code class="codehilite">helm</code> CLI in a safe environment.</li>
<li><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a>: Ingress can provide load balancing, SSL termination, and name-based virtual hosting. It acts as a web proxy for your applications and is useful if you want to use <em>Auto DevOps</em> or deploy your own web apps.</li>
<li><a href="https://prometheus.io/docs/introduction/overview/">Prometheus</a>: Prometheus is an open-source monitoring and alerting system useful to supervise your deployed applications.</li>
</ul>
<h2 id="how-to-manage-the-google-kubernetes-engine">How to manage the Google Kubernetes Engine</h2>
<p>The first step is to check the defined clusters [using the Google Cloud Platform console][gcp-console]. The most common target is, at first, to build and push a containarised application, which means that we start creating a new docker image in our machine, then after checking it locally, we push the image to a <em>docker container registry</em>. </p>
<p>Using GCP all these operations can be done by using a mix of <code class="codehilite">docker</code>, <code class="codehilite">gcloud</code> and <code class="codehilite">kubectl</code> commands. First things first, we must create one or more images using the instructions provided <a href="Docker">here</a>. After that, one can follow the instructions of <a href="https://cloud.google.com/kubernetes-engine/docs/tutorials/hello-app">this gcloud tutorial</a>.</p>
<h3 id="setting-a-static-ip-and-a-custom-domain-for-the-application">Setting a static IP and a custom domain for the application</h3>
<p>In our case we can <a href="https://cloud.google.com/kubernetes-engine/docs/tutorials/configuring-domain-name-static-ip#step_2a_using_a_service">assign a static IP address</a> for the service created one step above. The best way to achieve this, IMHO, is the web interface and precisely <a href="https://console.cloud.google.com/networking/addresses/add?project=together-rx">here</a>. </p>
<h3 id="update-the-image-used-for-the-current-kubernetes-pod">Update the image used for the current Kubernetes POD</h3>
<ol>
<li>
<p>Build a new snapshot optimized for production
<code class="codehilite">ng build --prod</code></p>
</li>
<li>
<p>Create a new image and tag it with a new version</p>
</li>
<li>
<p>Test the new image locally</p>
</li>
<li>
<p>Push the newly created image to the container registry</p>
</li>
</ol>
<p>To update the deployed container we can use the set command:
<code class="codehilite">kubectl set image deployment/together-rx ...</code></p>
<p><strong>Problem:</strong> A frequent question that comes up on Slack and Stack Overflow is how to trigger an update to a Deployment/RS/RC when the image tag hasn't changed but the underlying image has.</p>
<p>Consider:</p>
<ol>
<li>There is an existing Deployment with image <code class="codehilite"><span class="n">foo</span><span class="o">:</span><span class="n">latest</span></code></li>
<li>User builds a new image <code class="codehilite"><span class="n">foo</span><span class="o">:</span><span class="n">latest</span></code></li>
<li>User pushes <code class="codehilite"><span class="n">foo</span><span class="o">:</span><span class="n">latest</span></code> to their registry</li>
<li>User wants to do something here to tell the Deployment to pull the new image and do a rolling-update of existing pods</li>
</ol>
<p><strong>Possible solution for our current scenario:</strong> you are using <code class="codehilite">&#39;latest&#39;</code> for testing (this is the "no sed" use case), in this case, downtime is fine, and indeed the right approach is likely to <em>completely blow away your stack</em> and redeploy from scratch to get a clean run (=&gt; <code class="codehilite">kubectl set &lt;...&gt;</code>).</p>
<p>Keep reading <a href="https://github.com/kubernetes/kubernetes/issues/33664#issuecomment-258349316">here</a>.</p>
<h3 id="delete-a-kubernetes-service">Delete a Kubernetes service</h3>
<p>To stop and delete a Kubernetes instance/service corresponding to the image we created and then exposed we should instruct Kubernetes to tell the Load Balancer to delete the provisioned service with a simple command like that:</p>
<p><code class="codehilite">kubectl delete service container-1</code></p>
<p><strong>NOTE:</strong> The load balancer is deleted asynchronously in the background when you run <code class="codehilite">kubectl delete</code>. Wait until the load balancer is deleted by watching the output of the following command:</p>
<p><code class="codehilite">gcloud compute forwarding-rules list</code></p>
<h3 id="storage-and-dbs-on-gke">Storage and DBs on GKE</h3>
<ul>
<li>
<p><a href="https://codelabs.developers.google.com/codelabs/cloud-postgresql-gke-memegen/#0">High Availability PostgreSQL and Kubernetes with Google Cloud</a></p>
</li>
<li>
<p><a href="https://forvo.com/search/Kubernetes/">How to pronounce Kubernetes</a></p>
</li>
</ul>
                
                  
                
              
              
                


  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "http://torre.me.uk/docs/kubernetes/";
      this.page.identifier =
        "/kubernetes/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//alfredotorre.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../scala/" title="Scala" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Scala
              </span>
            </div>
          </a>
        
        
          <a href="../links/" title="Links" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Links
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/sentenza" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.5e60981f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>